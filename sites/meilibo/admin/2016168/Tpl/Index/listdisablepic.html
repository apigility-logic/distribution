<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta http-equiv="X-UA-Compatible" content="IE=7" /> 
<title>美丽播 - 后台管理中心</title> 
<link href="__PUBLIC__/statics/css/reset.css" rel="stylesheet" type="text/css" /> 
<link href="__PUBLIC__/statics/css/system.css" rel="stylesheet" type="text/css" /> 
<link href="__PUBLIC__/statics/css/table_form.css" rel="stylesheet" type="text/css" /> 
<link href="__PUBLIC__/statics/css/dialog.css" rel="stylesheet" type="text/css" /> 
<link rel="stylesheet" type="text/css" href="__PUBLIC__/meilibo/css/bootstrap.min.css">
<script type="text/javascript" src="__PUBLIC__/statics/js/dialog.js"></script>
<script type="text/javascript" src="__PUBLIC__/meilibo/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/statics/js/admin_common.js"></script> 
<script type="text/javascript" src="__PUBLIC__/statics/js/styleswitch.js"></script> 

</head> 
<body> 
<style type="text/css"> 
html{_overflow-y:scroll}
.pad-10{position:relative;height:100%;padding-bottom:240px;}
.playerbigpic{position:relative;width:12%;float:left;margin:0 1% 10px;border:1px solid #f9f9f9;cursor:pointer;}
.playerbigpic span{display:block;width:100%;height:100px;position:absolute;top:0;left:0;font-size:16px;text-align:center;line-height:100px;font-family:"Microsoft YaHei";font-weight:bold;text-align: center; moz-user-select: -moz-none; -moz-user-select: none; -o-user-select:none; -khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none; user-select:none;}
.playerbigpic p{margin:0;line-height:20px;padding-left:5px;white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.controlbtn{position:fixed;right:20px;bottom:100px;width:60px;}
.controlbtn button{margin-bottom:2px;}
.border-color1{border-color:#ec971f;}
.border-color2{border-color:#c9302c;}
.border-color3{border-color:#a29005;}
.background-color1{background:rgba(236,151,31,0.3);color:#ec971f;}
.background-color2{background:rgba(201,48,44,0.3);color:#c9302c;}
.background-color3{background:rgba(201,48,44,0.6);color:#a29005;}
.numpic1{position:absolute;top:-127px;left:0;z-index:10;background:#01a5a6;color:#fff;}
.numpic2{position:absolute;bottom:-127px;left:0;z-index:10;background:#01a5a6;color:#fff;}
.backcolor{background:#01a5a6;color:#fff;}
.selecttime{position:absolute;right:50px;top:6px;}
.selecttime span{display:inline-block;margin-right:10px;padding:6px;background:#ccc;color:#0c0c0c;}
#stop{margin-left:10px;}
.playerbigpic .opabg{position:absolute;top:0;left:0;z-index:10px;display:block;width:100%;height:100px;background:rgba(0,0,0,0.2);display:none;}
</style>
<div id="closeParentTime" style="display:none"></div> 
<div class="pad-10"> 
    <div class="content-menu ib-a blue line-x"> 
        <a href="javascript:;" onclick="javascript:$('#searchid').css('display','');"><em>搜索</em></a> 
    </div> 
<form name="myform" id="myform" action="__URL__/opt_user/" method="post" > 
<div class="table-list"></div> 
<div class="selecttime">
    <span>请选择自动刷新时间</span>
	<select name="time">
		<option value="20000">20s</option>
		<option value="60000">60s</option>
		<option value="120000">120s</option>
		<option value="240000">240s</option>
	</select>
	<button type="button" id="stop" class="btn btn-sm btn-info" tag="1">开启自动刷新</button>
</div>
<input type="hidden" id="return" name="return" value="{$_SERVER["REQUEST_URI"]|base64_encode}" >
</form>
</div> 
<script type="text/javascript"> 
var time=$(".selecttime").find("option:selected").val();
var settime="";
$(".selecttime").change(function(){
	time=$(this).find("option:selected").val();
	settime=setInterval(GetList,time);	
})
$("#stop").on("click",function(){
	   if($(this).attr("tag")==0){
	   		clearInterval(settime);
	   		$(this).text("开启自动刷新");
	   		$(this).attr("tag","1");
	   }else{
	   		settime=setInterval(GetList,time);
	   		$(this).text("关闭自动刷新");
	   		$(this).attr("tag","0");
	   }
	})
function GetList(){
$.ajax({
	 type: "POST",
	 url: "__URL__/GetShotPicList/",
	 data: {code:"Get"},
	 dataType: "json",
	 success: function(data){
	 	console.log(data);
		var html = "";
		var Entity = data.shot;
		var logEntity = data.log;
		if(Entity.length==0){
			$(".table-list").html("<div>现在还没有人直播</div>");
			return;
		}
		for(i = 0;i < Entity.length;i++){
			var timestamp = Entity[i]["rs_time"];
			var newDate = new Date();
			newDate.setTime(timestamp * 1000);
			$time = newDate.toTimeString();
			html += '<div class="playerbigpic" curroomnum="'+Entity[i]['rs_roomid']+'" tag="0"><img src="'+Entity[i]['rs_picurl']+'" onerror="javascript:this.src='+Entity[i]['rs_picurl']+'" curroomnum="'+Entity[i]['rs_roomid']+'" attr="'+Entity[i]['rs_id']+'"  width="100%" height="100px"><p>房间号：'+Entity[i]['rs_roomid']+'</p><p>时间：'+$time+'</p><span ></span></div>';
		}
		html += ' <div class="controlbtn"><button type="button" id="submit" class="btn btn-sm btn-info">提交</button></div>';
		$(".table-list").html(html);
		$(".playerbigpic").each(function(){
		for(j = 0;j< logEntity.length;j++){
			if($(this).attr("curroomnum") == logEntity[j]['roomid'])
			{
				switch(logEntity[j]['roomstatus']){
					case "1":
						$(this).addClass("border-color1");
						$(this).attr("tag","1");
						$(this).append('<span class="background-color1">有风险</span>');
					break;
					case "2":
						$(this).addClass("border-color2");
						$(this).attr("tag","2");
						$(this).append('<span class="background-color2">警告</span>');
					break;
					case "3":
						$(this).addClass("border-color3");
						$(this).attr("tag","3");
						$(this).append('<span class="background-color3">禁止</span>');
					break;
					case "0":
					break;
				}
			}
		}
		});
	  }
 })
}
//0 没问题
//1 有风险
//2 有问题

$(function(){
GetList();
if($(".table-list .playerbigpic").length==0){
	$(".table-list").text("现在还没有人直播");
}
})
$(".table-list").on("mouseenter",".playerbigpic",function(){
	var html1='<div class="numpic1"><img src="/style/meilibo/images/1.jpg" width="100%" height="105"><p>时间：12:06:30</p></div>'
	var html2='<div class="numpic2"><img src="/style/meilibo/images/2.jpg" width="100%" height="105"><p>时间：12:06:30</p></div>'
	var html3='<span class="opabg"></span>'
	$(this).prepend(html1);
	$(this).append(html2);
	$(this).append(html3);
	$(this).addClass("backcolor");
	$(".playerbigpic").find(".opabg").hide();
	$(this).find(".opabg").fadeIn();
	var Top=$(".numpic1").offset().top;
	if(Top<0){
		$(".numpic1").css("top","142px");
		$(".numpic2").css("bottom","-252px");
	}
})
$(".table-list").on("mouseleave",".playerbigpic",function(){
	$(".numpic1").remove();
	$(".numpic2").remove();
	$(".playerbigpic").find(".opabg").hide();
	$(this).removeClass("backcolor");
})
$(document).on("click",".playerbigpic",function(e){
   if($(this).attr("tag")=="0"){
   			$(this).addClass("border-color1").removeClass("border-color2")
   			$(this).find("span").text("有风险");
   			$(this).find("span").addClass("background-color1").removeClass("background-color2");
   			$(this).attr("tag","1");
   }else if($(this).attr("tag")=="1"){
   			$(this).addClass("border-color2").removeClass("border-color1");
   			$(this).find("span").text("警告");
   			$(this).find("span").addClass("background-color2").removeClass("background-color1");
   			$(this).attr("tag","2");
   }else if($(this).attr("tag")=="2"){
		    $(this).addClass("border-color3").removeClass("border-color2");
		    $(this).find("span").text("禁止");
		    $(this).find("span").addClass("background-color3").removeClass("background-color2");
		    $(this).attr("tag","3");
   }else{
   			$(this).removeClass("border-color1");
   			$(this).removeClass("border-color2");
        	$(this).removeClass("border-color3");
   			$(this).find("span").removeClass("background-color1");
        	$(this).find("span").removeClass("background-color2");
   			$(this).find("span").removeClass("background-color3");
   			$(this).find("span").text("");
   			$(this).attr("tag","0");
   }
   
});

$(document).on("click","#submit",function(){
	if(!confirm("确认提交吗?")){
		return;
	}
	submit_btn();
	window.location.reload();
  });
function submit_btn(){
	$Temp1Arr = [];
	$Temp2Arr = [];
	$Temp3Arr = [];
	$Temp0Arr = [];
	$(".playerbigpic").each(function(){
		switch($(this).attr("tag")){
			case "1":
				$Temp1Arr.push($(this).attr("curroomnum"));
			break;
			case "2":
				$Temp2Arr.push($(this).attr("curroomnum"));
			break;
			case "3":
				$Temp3Arr.push($(this).attr("curroomnum"));
			break;
			case "0":
				$Temp0Arr.push($(this).attr("curroomnum"));
			break;
		}
	});
       $.ajax({
             type: "POST",
             url: "__URL__/SetShotStatus/",
             data: {Temp0Arr:$Temp0Arr,Temp1Arr:$Temp1Arr,Temp2Arr:$Temp2Arr,Temp3Arr:$Temp3Arr},
             dataType: "text",
             success: function(data){
				 console.log(data);
              },
	          error:function(){
	          	alert("提交失败");
	          	return false;
	          }
         });
}
</script> 
</body> 
</html>