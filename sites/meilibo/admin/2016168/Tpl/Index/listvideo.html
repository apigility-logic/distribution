<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=7" />
<title>喵榜直播 - 后台管理中心</title>
<link href="/style/statics/css/reset.css" rel="stylesheet" type="text/css" />
<link href="/style/statics/css/system.css" rel="stylesheet" type="text/css" />
<link href="/style/statics/css/table_form.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" type="text/css" href="__PUBLIC__/meilibo/css/bootstrap.min.css">

<link href="/style/meilibo/dist/style/video-js.min.css" rel="stylesheet">
<script type="text/javascript" src="/style/meilibo/dist/js/video.js"></script>
<script type="text/javascript" src="/style/meilibo/dist/js/videojs-contrib-hls.js"></script>

<link rel="stylesheet" type="text/css" href="/style/statics/css/style/styles1.css" title="styles1" media="screen" />
<link rel="alternate stylesheet" type="text/css" href="/style/statics/css/style/styles2.css" title="styles2" media="screen" />
<link rel="alternate stylesheet" type="text/css" href="/style/statics/css/style/styles3.css" title="styles3" media="screen" />
<link rel="alternate stylesheet" type="text/css" href="/style/statics/css/style/styles4.css" title="styles4" media="screen" />
<style type="text/css">
     *{padding:0;margin:0;}
     body{width:100%;}
     ul{list-style:none;}
     .clearfix:after{display:block;font-size:0;content:'';clear:both;height:0;}
     .swfobject_box{padding:0.5% 0 0.5% 0.5%;}
     .swfobject_list li{position:relative;width:180px;height:160px;float:left;margin-right:0.5%;margin-bottom:15px;cursor:pointer;}
     .swfobject_list li .object.default{border:5px solid #fff;}
     .object.infobor{border:5px solid #31b0d5;}
     .object.warningbor{border:5px solid #f0ad4e;}
     .object.dangerbor{border:5px solid #d9534f;}
     .swfobject_list li img{display:block;float:left;}
     .object_btn{position:absolute;bottom:-42px;left:0;z-index:1;width:100%;background:#d8d7d7;padding:10px 0;text-align:center;box-shadow:0 0 10px #666;border-radius:0 0 3px 3px;}
     .object_btn .btn{margin:0 1px;}
     .swfobject_list li:hover{box-shadow:0 0 5px #666;}
     #submit{position:fixed;right:50px;bottom:20%;}
  </style>
<script language="javascript" type="text/javascript" src="/style/statics/js/jquery-1.8.3.min.js"></script>
<script language="javascript" type="text/javascript" src="/style/statics/js/admin_common.js"></script>
<script language="javascript" type="text/javascript" src="/style/statics/js/styleswitch.js"></script>
<script type="text/javascript">
    window.focus();
</script>
</head>
<body>
  <div class="swfobject_box">
      <div class="livebox">
        <ul class="swfobject_list clearfix">
        </ul>
        <button type="button" id="submit" class="btn btn-sm btn-primary" onclick="submit_btn()">提交</button>
      </div>
   </div>
   <script type="text/javascript">
    $(function(){
        getObject();
        setInterval(getObject,5000);
        function getObject(){
            var html='';
            var nowarr=[];//现在页面的房间号
            var temparr = [];//从七牛拿的房间
            var roomnum='';
            $(".swfobject_list li").each(function(){
                roomnum = $(this).find(".object").attr("curroomnum");
                nowarr.push(roomnum);
            });

            console.log(nowarr)
            $.ajax({
                 type: "GET",
                 url: "__URL__/gettest",
                 dataType: "json",
                 //async:false,
                 success:function(data){
                    console.log(data);
                    

                    if(data.length < 1){
                        $(".swfobject_list li").each(function(){
                            $(this).remove();
                        })
                        $(".swfobject_list").html("<p>当前暂无人直播</p>");
                        return;
                    }else{
                        $(".swfobject_list p").remove();
                    }
                    for(var x=0;x<data.length;x++){
                        temparr.push(data[x]['roomId']);
                        if($.inArray(data[x]['roomId'],nowarr) < 0){
                            switch(data[x]['status']){
                                case "0":
                                html +='<li class="room-'+data[x]['roomId']+'">' +
                                    '<iframe width="180" height="160" frameborder="0" scrolling="no" class="object default" curroomnum="'+data[x]['roomId']+'" src="/2016168/index.php/Index/onlineVideo?room_id='+data[x]['roomId']+'"></iframe>'
                                    +'</li>';
                                break;
                                case "1":
                                    html +='<li class="room-'+data[x]['roomId']+'">' +
                                            '<iframe  width="180" height="160" frameborder="0" scrolling="no"class="object default" curroomnum="'+data[x]['roomId']+'" src="/2016168/index.php/Index/onlineVideo?room_id='+data[x]['roomId']+'"></iframe>'
                                            +'</li>';
                                    break;
                                case "2":
                                    html +='<li class="room-'+data[x]['roomId']+'">' +
                                            '<iframe  width="180" height="160" frameborder="0" scrolling="no"class="object default" curroomnum="'+data[x]['roomId']+'" src="/2016168/index.php/Index/onlineVideo?room_id='+data[x]['roomId']+'"></iframe>'
                                            +'</li>';
                                    break;
                                case "3":
                                    html +='<li class="room-'+data[x]['roomId']+'">' +
                                            '<iframe  width="180" height="160" frameborder="0" scrolling="no"class="object default" curroomnum="'+data[x]['roomId']+'" src="/2016168/index.php/Index/onlineVideo?room_id='+data[x]['roomId']+'"></iframe>'
                                            +'</li>';
                                    break;
                            }
                        }
                    }
                    for(var y=0;y<nowarr.length;y++){
                        //console.log(temparr);
                        if($.inArray(nowarr[y],temparr) < 0){
                            $(".room-"+nowarr[y]).remove();
                        }
                    }
                    $(".swfobject_list").append(html);
                    //console.log(data[0]['rtmpurl']);
                    html = "";
                 }
            })
        };

           $(document).on("mouseenter",".swfobject_list li",function(){
               var button='';
               button='<div class="object_btn">'
                        +'<button class="btn btn-xs btn-info" tag="1">有风险</button>'
                        +'<button class="btn btn-xs btn-warning" tag="2">警告</button>'
                        +'<button class="btn btn-xs btn-danger" tag="3">禁止</button>'
                        +'<button class="btn btn-xs btn-danger" tag="3">详情</button>'
                        +'<button class="btn btn-xs btn-success" tag="0">取消</button>'
                    +'</div>'
                $(this).append(button);
           })
          $(document).on("mouseleave",".swfobject_list li",function(){
            $(".object_btn").remove();
          })
        $(document).on("click",".btn-info",function(){
            $(this).parents("li").find('.object').addClass("infobor");
            $(this).parents("li").find('.object').attr("tag","1");
            $(this).parents("li").find('.object').removeClass("warningbor dangerbor default");
        })
        $(document).on("click",".btn-warning",function(){
            $(this).parents("li").find('.object').addClass("warningbor");
            $(this).parents("li").find('.object').attr("tag","2");
            $(this).parents("li").find('.object').removeClass("infobor dangerbor default");
        })
        $(document).on("click",".btn-danger",function(){
            $(this).parents("li").find('.object').addClass("dangerbor");
            $(this).parents("li").find('.object').attr("tag","3");
            $(this).parents("li").find('.object').removeClass("infobor warningbor default");
        })
        $(document).on("click",".btn-success",function(){
            $(this).parents("li").find('.object').addClass("default");
            $(this).parents("li").find('.object').attr("tag","0");
            $(this).parents("li").find('.object').removeClass("infobor warningbor dangerbor");
        })
    });

    function submit_btn(){
        $Temp1Arr = [];
        $Temp2Arr = [];
        $Temp3Arr = [];
        $Temp0Arr = [];
        $(".object").each(function(){
            switch($(this).attr("tag")){
                case "1":
                    $Temp1Arr.push($(this).attr("curroomnum"));
                break;
                case "2":
                    $Temp2Arr.push($(this).attr("curroomnum"));
                break;
                case "3":
                    $Temp3Arr.push($(this).attr("curroomnum"));
                break;
                case "0":
                    $Temp0Arr.push($(this).attr("curroomnum"));
                break;
            }
        });
        console.log($Temp0Arr);
        console.log($Temp1Arr);
        console.log($Temp2Arr);
        console.log($Temp3Arr);
       $.ajax({
             type: "POST",
             url: "__URL__/SetShotStatus/",
             data: {Temp0Arr:$Temp0Arr,Temp1Arr:$Temp1Arr,Temp2Arr:$Temp2Arr,Temp3Arr:$Temp3Arr,Status:"false"},
             dataType: "text",
             success: function(data){
               console.log(data);
              },
              error:function(){
                console.log("提交失败");
              }
         });
}
   </script>
</body>
</html>