<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="Generator" content="EditPlus®">
  <meta name="Author" content="">
  <meta name="Keywords" content="">
  <meta name="Description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
  <title>个人中心</title>
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/meilibo/dist/style/iconfont.css">
  <link rel="stylesheet" type="text/css" href="__PUBLIC__/meilibo/dist/style/style.css">
  <script type="text/javascript" src="__PUBLIC__/meilibo/dist/js/jquery-1.10.1.min.js"></script>
 </head>
 <body>
   <section class="formsection">
   <div class="prev_back"><i ><a class="icon iconfont" href="{:U('share_profile')}?uid={$userinfo.id}&token={$token}&current_room={$userinfo.current_room}">&#xe614;</a></i>修改资料</div>
    <form action="{:U(editUserinfo)}" enctype="multipart/form-data" method="post" id="form" name="form">
      <article>
        <ul class="form_list">
          <li>
              <label>呢称：</label>
              <div class="label"><input type="text" name="nickname" value="{$userinfo.nickname}"   /></div>
          </li>
          <li>
              <label>个性签名：</label>
              <div class="label">
                <textarea name="intro"><if condition = " $userinfo.intro eq '' ">这家伙很懒，什么都没有留下<else />{$userinfo.intro}</if></textarea>
              </div>
          </li>
          <li>
               <label>修改头像：</label>
               <div class="upfile clearfix">
                   <span class="upfileimg"><img onerror="javascript:this.src='/dist/img/0_big.jpg'" src="{$userinfo.avatar}" width="100" height="100"></span>
                   <input type="file" id="files" class="addimg" name="photo" accept="image/*" onchange="previewImage(this, 'list')"/>
                   <output id="list" class="listpic"></output>
                   <if condition = "$status == '1'">
                      <span color="red">图片过大或者格式不正确，请重新提交</span>
                   </if>
               </div>
            </li>
            <li class="submitart">
                <button type="submit"  id="submit" class="submit_button" onclick="myCheck();">提交
                  <div class="loader">
                    <div class="loader-inner ball-pulse">
                      <div></div>
                      <div></div>
                      <div></div>
                    </div>
                  </div>
                </button>
            </li>
        </ul>
        <input type="hidden" name="uid" value="{$userinfo.id}" /> 
    </form>
</section>
<script type="text/javascript">
    function previewImage(file, prvid) {
    /* file：file控件
     * prvid: 图片预览容器
     */
    var tip = "Expect jpg or png or gif!"; // 设定提示信息
    var filters = {
        "jpeg"  : "/9j/4",
        "gif"   : "R0lGOD",
        "png"   : "iVBORw"
    }
    var prvbox = document.getElementById(prvid);
    prvbox.innerHTML = "";
    if (window.FileReader) { // html5方案
        for (var i=0, f; f = file.files[i]; i++) {
            var fr = new FileReader();
            fr.onload = function(e) {
                var src = e.target.result;
                if (!validateImg(src)) {
                    alert(tip)
                } else {
                    showPrvImg(src);
                }
            }
            fr.readAsDataURL(f);
        }
    } else { // 降级处理
        if ( !/\.jpg$|\.png$|\.gif$/i.test(file.value) ) {
            alert(tip);
        } else {
            showPrvImg(file.value);
        }
    }
   
    function validateImg(data) {
        var pos = data.indexOf(",") + 1;
        for (var e in filters) {
            if (data.indexOf(filters[e]) === pos) {
                return e;
            }
        }
        return null;
    }
 
    function showPrvImg(src) {
        var img = document.createElement("img");
        img.src = src;
        prvbox.appendChild(img);
    }
}
  function myCheck(){ 
         $(".loader").addClass("show");
         $(".submit_button").css("background","#c3bbbb");
      }
</script>
 </body>
</html>
